.signup-wrapper.user-location
	.title Add Your City

	.intro-blurb
		%p Lorem ipsum dolor sit amet, consectetur adipiscing elit. In facilisis enim eget auctor elementum. In ac sapien molestie, suscipit augue id, facilisis velit.

	- @user = current_user
	.add-city
		= form_for(@user, remote: true, url: add_city_path) do |f|
			= f.hidden_field :id, value: @user.id
			- @search = Geocoder.search(request.remote_ip).first.data
			- @default = @search['city'] == '' ? '' : @search['city'] + ', ' + @search['region_name']
			= f.text_field :city, placeholder: 'e.g. "Toronto, Ontario"', value: @default, class: 'user-city'
			.search-results

:javascript

	function searchAddress() {
		$.ajax({
			url: '/search_cities',
			data: {address: $('.add-city .user-city').val()}
		}).success(function(data) {
			console.log(data);
			populateGeoResults(data);
		});
	}

	function populateGeoResults(data) {
		$(".add-city .search-results").empty();
		var keys = Object.keys(data);
		if(keys.length > 0) {
			for(i = 0; i < keys.length; i++) {
				var div = '<div class="result-item">';
				div += data[i].formatted_address;
				div += '</div>';
				div = $(div);
				$(".add-city .search-results").append(div);
				div.click(selectResult);
			}
		}
		else {
			if($('.add-city form .user-city').val() === '') $(".add-city .search-results").empty();
			else $(".add-city .search-results").append('Sorry no results found');
		}

	}

	function selectResult() {
		$(".add-city .user-city").val($(this).html());
		$(".add-city .search-results").empty();
		$(".add-city form").submit();
	}

	$('.add-city form .user-city').typing({
		stop: searchAddress,
		delay: 500
	});
- if signed_in?
	= render template: 'users/show'
- else
	.inner-content
		%h1.bg-title Find Your Tune
		.buttons
			#sign-in= link_to('CONNECT WITH FACEBOOK', "/auth/facebook", remote: true)
			= #link_to('REGISTER', signup_path, remote: true, class: 'page_link')
		.log-in
			= #link_to('Sign in', signin_path, remote: true, class: 'page_link bg-faded')

:javascript
	$('#fb-root').remove();
	$('body').prepend('<div id="fb-root"></div>');
	emailReg = /^[\w+\-.]+@[a-z\d\-.]+\.[a-z]{2,4}$/i
	inviteToken = '#{@invite_token}'
	console.log(inviteToken);

	$.ajax({
		url: "" + window.location.protocol + "//connect.facebook.net/en_US/all.js",
		dataType: 'script',
		cache: true
	});

	window.fbAsyncInit = function() {
		$('#sign-in').click(function(e) {
			console.log('#{ENV["FACEBOOK_APP_ID"]}');
		  e.preventDefault();
		  FB.login(function(response) {
		    if (response.authResponse) {
					$.ajax({
						url: '/auth/facebook/callback',
						data: {state: inviteToken}
					});
		    }
		  }, {scope: 'email,user_likes'});
		});

		FB.init({
		  appId: '#{ENV["FACEBOOK_APP_ID"]}',
			status: true,
		  cookie: true
		});
	};

	$('.email-check').typing({
		stop: function(event, elem) {
			elem.parent('form').children('.tick-mark').hide();
			if(!emailReg.test(elem.val())) {
				elem.parent('form').children('.x-mark').show();
			}
			else {
				elem.parent('form').children('.check-mark').show();
			}
		},
		delay: 200
	});

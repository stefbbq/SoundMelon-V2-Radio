var ytPlayerReady=!1,scPlayerReady=!1,runOnYTReady=!1,runInitSC=!1,newArtistProfile,scrubInterval,volume=100,ytQuality="large",scrubDelay=1500,SMradioManager=function(e){function o(){m=new SMplayersManager(e),_=new SMartistsManager,$("#radio-controls #play-pause").click(s),$("#radio-controls #next-song").click(l),$("#radio-controls #previous-song").click(t),$("#get-artist-info").click(i),$("#radio-stations a").click(r),$("#report-song").click(u),$("#radio-stations #user-meta").trigger("click")}function s(){$(this).children(".control-image").removeClass("play-image pause-image").addClass("loading-image"),I?c():a()}function l(){clearInterval(scrubInterval),$("#seek-slider").simpleSlider("setValue",0),I&&("youtube"===I.upload_source?ytPlayer.stopVideo():"soundcloud"===I.upload_source&&scWidget.pause(),g())}function t(){I&&k.length>0&&(w=!0,$("#radio-controls #next-song").trigger("click"))}function i(){_.setArtistInfo(this,I)}function r(){V=W,V!==this.id&&($("#"+V).toggleClass("idle streaming"),W=this.id,$("#"+W).toggleClass("idle streaming"),I&&("youtube"===I.upload_source?ytPlayer.stopVideo():"soundcloud"===I.upload_source&&scWidget.pause(),a()))}function u(){return z=this.href.split(/song_id=|(?=&user_id)/),this.href=z[0]+"song_id="+z[z.length-1],reportBox=$(".report-box"),I?(y=this.href.split("song_id="),this.href=y[0]+"song_id="+I.song_id+y[1],console.log(this.href),!0):!1}function a(){var e={station:W,played_songs:b,user_id:currentUserId};console.log(e),$.ajax({url:"/request_playlist",data:e,success:function(e){e.length>0?(P=shuffleList(e),d()):n()}}),b=[]}function n(){$.ajax({url:"/request_history_reset",data:{station:W,user_id:currentUserId},success:function(e){P=shuffleList(e),console.log(P),d()}})}function d(){if(console.log("trying to execute playlist"),ytPlayerReady){if(console.log("all ready and initialized!"),P.length>0){var e=P[0],o=e.upload_source;I=e,_.showArtistInfo(I),"youtube"===o?($("#soundcloud, .overlay, .overlay .song-link").hide(),$("#youtube").css("display","block"),ytPlayer.loadVideoById({videoId:e.song_id}),ytPlayer.setVolume(volume)):"soundcloud"===o&&(m.loadSCSong(I),$("#youtube").hide(),$("#soundcloud, .overlay, .overlay .song-link").show()),setTimeout(p,1e4)}}else runOnYTReady||(console.log("initializing the players."),m.onYouTubeIframeAPIReady(),m.initSCPlayer(),runOnYTReady=!0)}function c(){if("youtube"===I.upload_source){var e=ytPlayer.getPlayerState();/[25]|-1/.test(e)?(ytPlayer.setVolume(volume),ytPlayer.playVideo()):/[13]/.test(e)&&ytPlayer.pauseVideo()}else"soundcloud"==I.upload_source&&(scWidget.paused?(scWidget.setVolume(volume),scWidget.play()):(console.log("sc pausing..."),scWidget.pause()))}function g(){if(w?(P.unshift(k.pop()),b.pop(),w=!1):(k.push(P.shift()),b.push(k[k.length-1].song_id)),P.length>0){var e=P[0];S=I,I=e,_.showArtistInfo(I),console.log("hiding .player"),"youtube"===e.upload_source?(ytPlayer.loadVideoById({videoId:I.song_id}),ytPlayer.setVolume(volume),$("#soundcloud, .overlay, .overlay .song-link").hide(),$("#youtube").show()):"soundcloud"===e.upload_source&&(m.loadSCSong(I),$("#youtube").hide(),$("#soundcloud, .overlay, .overlay .song-link").show()),calloutBox=$(".callout#show-artist-profile"),1===calloutBox.css("opacity")&&(newArtistProfile=!0,$("#get-artist-info").click()),setTimeout(p,1e4)}else a()}function p(){var e;if("youtube"===I.upload_source){var o=ytPlayer.getPlayerState();/3|-1/.test(o)&&(e=!0)}else"soundcloud"===I.upload_source&&(console.log(scWidget.isBuffering),(!scWidget||scWidget.isBuffering)&&(e=!0));if(e){var s;s=x?{severity:"error",message:"There was a loading error, please reload the page."}:{severity:"warning",message:"Please wait while we get the content!"},FlashManager.showMessage(s),x=!0,setTimeout(p,1e4)}else console.log("no load delays!")}function f(){if(I){var e;"youtube"===I.upload_source?e=ytPlayer.getCurrentTime()/ytPlayer.getDuration():"soundcloud"===I.upload_source&&(e=scWidget.position/scWidget.duration),$("#seek-slider").simpleSlider("setValue",e)}}function v(e){console.log("executing..."),I&&("youtube"===I.upload_source?(ytPlayer.seekTo(e*ytPlayer.getDuration()),console.log(ytPlayer.getCurrentTime())):"soundcloud"===I.upload_source&&(scWidget.setPosition(e*scWidget.duration),console.log(scWidget.position)),scrubInterval=setInterval(f,scrubDelay))}function h(e){return"youtube"===e.upload_source?ytPlayer.getCurrentTime():"soundcloud"===e.upload_source?scWidget.position/1e3:void 0}var m,_,P,k,b,I,w,S,V,W,T,x,k=[],b=[];return $(".volume-container #volume-slider").slider({orientation:"vertical",range:"min",change:function(e,o){volume=o.value,I&&("youtube"===I.upload_source?ytPlayer.setVolume(volume):"soundcloud"===I.upload_source&&scWidget.setVolume(volume))}}),$(".volume-container #volume-slider").slider("value",volume),$(".volume-container #show-slider, .volume-controls").hover(function(){$(".volume-controls").toggle()}),$("#seek-slider").simpleSlider({highlight:!0}),$("#seek-slider").simpleSlider("setValue",0),$("#seek-slider").bind("slider:changed",function(e,o){seekValue=o.value,T=secToMinSec(h(I)),$("#radio-controls .seek-scrub .seek-val span.current-time").text(T)}),$(".media-seeker .slider").mouseup(function(){clearInterval(scrubInterval),console.log("initialize..."),v(seekValue)}),{enable:o,seekTracker:f,executePlaylist:d,playNextSong:g,playersManager:m}};